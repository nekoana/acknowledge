> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/7154944949132197924)

æœ¬æ–‡ä¸ºç¨€åœŸæ˜é‡‘æŠ€æœ¯ç¤¾åŒºé¦–å‘ç­¾çº¦æ–‡ç« ï¼Œ14 å¤©å†…ç¦æ­¢è½¬è½½ï¼Œ14 å¤©åæœªè·æˆæƒç¦æ­¢è½¬è½½ï¼Œä¾µæƒå¿…ç©¶ï¼

æœ¬ç¯‡æ–‡ç« æ˜¯æ­¤ä¸“æ çš„ç¬¬äº”ç¯‡æ–‡ç« ï¼Œæœ¬ç¯‡æ–‡ç« åº”è¯¥æ˜¯æ­¤ä¸“æ ä¸­æœ€åä¸€ç¯‡ç›´æ¥å…³äºåŠ¨ç”»çš„æ–‡ç« äº†ï¼Œä¹‹åæ–‡ç« ä¸­å¯èƒ½ä¼šæåˆ°ï¼Œä½†åº”è¯¥ä¸ä¼šå¤§å¹…ä»‹ç»äº†ã€‚å¦‚æœæƒ³é˜…è¯»å‰å‡ ç¯‡æ–‡ç« çš„è¯å¯ä»¥ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ï¼š

*   [Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹ç…ä¸‹ Compose çš„åŠ¨ç”»](https://juejin.cn/post/7144918481668931620 "https://juejin.cn/post/7144918481668931620")
*   [Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹å¯è§æ€§åŠ¨ç”»](https://juejin.cn/post/7146034360670486542 "https://juejin.cn/post/7146034360670486542")
*   [Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹å±æ€§åŠ¨ç”»](https://juejin.cn/post/7148631147705008142 "https://juejin.cn/post/7148631147705008142")
*   [Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹åŠ¨ç”»è§„æ ¼](https://juejin.cn/post/7153441774986821662 "https://juejin.cn/post/7153441774986821662")

è¯´èµ·çµåŠ¨å²›ï¼Œå¤§å®¶è‚¯å®šéƒ½ä¸é™Œç”Ÿï¼Œå› ä¸ºè¿™æ®µæ—¶é—´è¿™ä¸ªä¸œè¥¿å®åœ¨æ˜¯å¤ªç«äº†ï¼Œè¿™æ˜¯è‹¹æœ 14 ä¸­ç®—æ˜¯æœ€å¤§çš„æ›´æ–°äº†ğŸ˜‚ï¼Œä¸æ‹¿ç¼ºç‚¹å½“ç¼ºç‚¹ï¼Œå¹¶ä¸”è¿˜èƒ½åœ¨ç¼ºç‚¹ä¸Šç©å‡ºèŠ±ï¼Œè¿™ä¸ªäº§å“æ€è·¯ç¡®å®å‰å®³ğŸ‘ï¼Œä¸å¾—ä¸æœï¼çµåŠ¨å²›çœ‹ç€æ•ˆæœæŒºç‚«ï¼Œå…¶å®å®ç°èµ·æ¥å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œä»Šå¤©å¸¦å¤§å®¶ä¸€èµ·æ¥ä½¿ç”¨ `Compose` å®ç°ä¸‹å±äºå®‰å“çš„ â€œçµåŠ¨å²›â€ï¼åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹ä¸‹æœ¬ç¯‡æ–‡ç« å®ç°çš„æ•ˆæœã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f2d151b5e4e4aa39bad7d5f77d238ca~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

çœ‹ç€è¿˜å¯ä»¥å§ï¼Œå“ˆå“ˆå“ˆï¼Œæ¥ç€å¾€ä¸‹è¯´ï¼

è‹¹æœçš„çµåŠ¨å²›
------

åœ¨ç½‘ä¸Šæ‰¾äº†å†™çµåŠ¨å²›çš„è§†é¢‘ï¼Œå¤§å®¶æƒ³çœ‹çš„å¯ä»¥ç‚¹å‡»é“¾æ¥å»çœ‹ä¸‹ï¼Œè‚¯å®šæ¯” Gif å›¾æ¸…æ™°ã€‚

[çµåŠ¨å²›è§†é¢‘](https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV18P411376q%2F%3Fspm_id_from%3D333.337.search-card.all.click%26vd_source%3Db21889e28b7a44b6b6d049dff570d0b6 "https://www.bilibili.com/video/BV18P411376q/?spm_id_from=333.337.search-card.all.click&vd_source=b21889e28b7a44b6b6d049dff570d0b6")

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf7861f530ba4b919e6d0b13df5af4a1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å—¯ï¼Œè¿™æ ·çœ‹ç€ç¡®å®æŒºå¥½çœ‹ï¼Œå¦‚æœä¸æ˜¯è§è¿‡çœŸæœºæ˜¾ç¤ºæ•ˆæœæˆ‘çœŸçš„å°±ä¿¡äº†ğŸ˜‚ï¼Œä¸è¿‡è¿˜æ˜¯ä¸Šé¢è¯´çš„ï¼Œæ€è·¯å¥‡ç‰¹ï¼Œå¤§æ–¹æ‰¿è®¤ç¼ºç‚¹å€¼å¾—è‚¯å®šï¼

Compose ç®€å•å®ç°
------------

ä¹‹å‰å‡ ç¯‡æ–‡ç« å¤§æ¦‚è¯´äº†ä¸‹ `Compose` ä¸­çš„åŠ¨ç”»ï¼Œæ€è€ƒä¸‹è¿™ä¸ªåŠ¨ç”»è¯¥å¦‚ä½•å†™ï¼Ÿæˆ‘åˆšçœ‹åˆ°è¿™ä¸ªåŠ¨ç”»çš„æ—¶å€™ä¹Ÿè§‰å¾—å®ç°èµ·æ¥ä¸å®¹æ˜“ï¼Œä½†å…¶å®è½¬å¿µä¸€æƒ³å¹¶ä¸éš¾ï¼Œå…¶å®è¿™äº›åŠ¨ç”»æ€»ç»“ä¸‹æ¥å°±æ˜¯æ ¹æ®äº‹ä»¶ä¸åŒ Size çš„å¤§å°ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ï¼Œå¦‚æœåœ¨ä¹‹å‰åŸç”Ÿå®‰å“å®ç°çš„è¯ä¼šå¤æ‚ä¸€äº›ï¼Œä½†åœ¨ `Compose` ä¸­å°±å¾ˆç®€å•äº†ï¼Œè¿˜è®°å¾—ä¹‹å‰å‡ ç¯‡æ–‡ç« ä¸­æåˆ°çš„ `animateSizeAsState` ä¹ˆï¼Ÿè¿™æ˜¯ `Compose` ä¸­å¼€ç®±å³ç”¨çš„ APIï¼Œè¿™é‡Œå…¶å®å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å®ç°ï¼Œæ¥ä¸€èµ·çœ‹ä¸‹ä»£ç ï¼

```
@Composable
fun DynamicScreen() {
 Â  Â var isCharge by remember { mutableStateOf(true) }
â€‹
 Â  Â val animateSizeAsState by animateSizeAsState(
 Â  Â  Â  Â targetValue = Size(if (isCharge) 170f else 100f, 30f)
 Â   )
â€‹
 Â  Â Column {
 Â  Â  Â  Â Box(modifier = Modifier
 Â  Â  Â  Â  Â  Â  Â   .width(animateSizeAsState.width.dp)
 Â  Â  Â  Â  Â  Â  Â   .height(animateSizeAsState.height.dp)
 Â  Â  Â  Â  Â  Â  Â   .shadow(elevation = 3.dp, shape = RoundedCornerShape(15.dp))
 Â  Â  Â  Â  Â  Â  Â   .background(color = Color.Black),
 Â  Â  Â   )
â€‹
 Â  Â  Â  Â Button(
 Â  Â  Â  Â  Â  Â modifier = Modifier.padding(top = 30.dp, bottom = 5.dp),
 Â  Â  Â  Â  Â  Â onClick = { isCharge = false }) {
 Â  Â  Â  Â  Â  Â Text(text = "é»˜è®¤çŠ¶æ€")
 Â  Â  Â   }
â€‹
 Â  Â  Â  Â Button(
 Â  Â  Â  Â  Â  Â modifier = Modifier.padding(vertical = 5.dp),
 Â  Â  Â  Â  Â  Â onClick = { isCharge = true }) {
 Â  Â  Â  Â  Â  Â Text(text = "å……ç”µçŠ¶æ€")
 Â  Â  Â   }
 Â   }
}
å¤åˆ¶ä»£ç 
```

å…¶å®æ ¸å¿ƒä»£ç åªæœ‰ä¸€è¡Œï¼Œå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ `animateSizeAsState` ï¼Œå…¶ä»–çš„ä»£ç åŸºæœ¬éƒ½åœ¨ç”»å¸ƒå±€ï¼Œè¿™é‡Œä½¿ç”¨ `Box` æ¥ç”»äº†ä¸‹çµåŠ¨å²›çš„é»‘è‰²åœ†è§’ï¼Œå¹¶ä¸”å°† `box` çš„èƒŒæ™¯è®¾ç½®ä¸ºäº†é»‘è‰²ï¼Œç„¶åç”»äº†ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªè¡¨ç¤ºå……ç”µçŠ¶æ€ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºé»˜è®¤çŠ¶æ€ï¼Œç‚¹å‡»æŒ‰é’®å°±å¯ä»¥è¿›è¡Œåˆ‡æ¢ï¼Œæ¥çœ‹ä¸‹æ•ˆæœï¼

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32d619014737426ebca31d428ebda271~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å¤§æ¦‚æ ·å¼æœ‰äº†ï¼Œä½†æ˜¯ä¸æ˜¯æ„Ÿè§‰å°‘äº†ç‚¹ä»€ä¹ˆï¼Ÿæ²¡é”™ï¼è‹¹æœçš„åŠ¨ç”»æœ‰å›å¼¹æ•ˆæœï¼Œä½†å’±ä»¬è¿™ä¸ªæ²¡æœ‰ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿˜å¥½ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å’±ä»¬è®²è¿‡åŠ¨ç”»è§„æ ¼ï¼Œè¿™é‡Œå°±ä½¿ç”¨ `Spring` å°±å¯ä»¥æ»¡è¶³å’±ä»¬çš„éœ€æ±‚äº†ï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£ `Compose` åŠ¨ç”»è§„æ ¼çš„è¯å¯ä»¥ç§»æ­¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼š[Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹åŠ¨ç”»è§„æ ¼](https://juejin.cn/post/7153441774986821662 "https://juejin.cn/post/7153441774986821662")ã€‚

æ¥ç¨å¾®æ”¹ä¸‹ä»£ç ï¼š

```
val animateSizeAsState by animateSizeAsState(
 Â  Â targetValue = Size(if (isCharge) 170f else 100f, 30f),
 Â  Â animationSpec = spring(
 Â  Â  Â  Â dampingRatio = Spring.DampingRatioLowBouncy,
 Â  Â  Â  Â stiffness = Spring.StiffnessMediumLow
 Â   )
)
å¤åˆ¶ä»£ç 
```

åˆ«çš„ä»£ç éƒ½æ²¡åŠ¨ï¼Œåªæ˜¯ä¿®æ”¹äº†ä¸‹åŠ¨ç”»è§„æ ¼ï¼Œå†æ¥çœ‹ä¸‹æ•ˆæœï¼

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89dddb94929642ebb253e31c1cffb37e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å—¯ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹æ„æ€äº†ï¼

å®ç°å¤šç§åˆ‡æ¢
------

ä¸Šé¢å’±ä»¬ç®€å•å®ç°äº†å……ç”µçš„ä¸€ç§çŠ¶æ€ï¼Œä½†æ˜¯å’±ä»¬å¯ä»¥çœ‹åˆ°è‹¹æœé‡Œé¢å¯ä¸æ­¢è¿™ä¸€ç§ï¼Œä¸Šé¢å’±ä»¬ä½¿ç”¨çš„æ˜¯ `Boolean` å€¼æ¥è¿›è¡Œåˆ‡æ¢çš„ï¼Œä½†å¦‚æœå¤šç§çŠ¶æ€çš„è¯ `Boolean` å°±æœ‰ç‚¹åŠ›ä¸ä»å¿ƒäº†ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—è€ƒè™‘æ–°çš„æ–¹æ¡ˆäº†ï¼

```
private sealed class BoxState(val height: Dp, val width: Dp) {
 Â  Â // é»˜è®¤çŠ¶æ€
 Â  Â object NormalState : BoxState(30.dp, 100.dp)
â€‹
 Â  Â // å……ç”µçŠ¶æ€
 Â  Â object ChargeState : BoxState(30.dp, 170.dp)
â€‹
 Â  Â // æ”¯ä»˜çŠ¶æ€
 Â  Â object PayState : BoxState(100.dp, 100.dp)
â€‹
 Â  Â // éŸ³ä¹çŠ¶æ€
 Â  Â object MusicState : BoxState(170.dp, 340.dp)
â€‹
 Â  Â // å¤šä¸ªçŠ¶æ€
 Â  Â object MoreState : BoxState(30.dp, 100.dp)
}
å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°ä¸Šé¢ä»£ç ä¸­å†™äº†ä¸€ä¸ªå¯†å°ç±»ï¼Œå‚æ•°å°±æ˜¯çµåŠ¨å²›çš„å®½å’Œé«˜ï¼Œç„¶åæ ¹æ®è‹¹æœçµåŠ¨å²›çš„æ ·å¼å¤§æ¦‚å¯ä»¥åˆ†ä¸ºäº†å‡ ç§çŠ¶æ€ï¼šé»˜è®¤çŠ¶æ€å°±æ˜¯ä¸€å°æ¡ï¼›å……ç”µçŠ¶æ€é«˜åº¦è¾ƒé»˜è®¤çŠ¶æ€ä¸å˜ï¼Œå®½åº¦å¢åŠ ï¼›æ”¯ä»˜çŠ¶æ€é«˜åº¦å¢åŠ ï¼Œå®½åº¦è¾ƒé»˜è®¤çŠ¶æ€ä¸å˜ï¼›éŸ³ä¹çŠ¶æ€é«˜åº¦å’Œå®½åº¦éƒ½è¾ƒé»˜è®¤çŠ¶æ€å¢åŠ ï¼›å¤šä¸ªåº”ç”¨çŠ¶æ€å®½åº¦ä¸å˜ï¼Œä½†ä¼šå¤šå‡ºä¸€ä¸ªå°é»‘åœ†ç‚¹ã€‚

ä¸‹é¢è¿˜éœ€è¦ä¿®æ”¹ä¸‹çŠ¶æ€ï¼š

```
var boxState: BoxState by remember { mutableStateOf(BoxState.NormalState) }
å¤åˆ¶ä»£ç 
```

å°†çŠ¶æ€å€¼ç”± `Boolean` æ”¹ä¸ºäº†åˆšåˆšç¼–å†™çš„ `BoxState` ï¼Œç„¶åä¿®æ”¹ä¸‹ `animateSizeAsState` çš„ä½¿ç”¨ï¼š

```
val animateSizeAsState by animateSizeAsState(
 Â  Â targetValue = Size(boxState.width.value, boxState.height.value), 
    animationSpec = spring(
 Â  Â  Â  Â dampingRatio = Spring.DampingRatioLowBouncy,
 Â  Â  Â  Â stiffness = Spring.StiffnessMediumLow
 Â   )
)
å¤åˆ¶ä»£ç 
```

æ¥ä¸‹æ¥å†ä¿®æ”¹ä¸‹æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼š

```
Button(
 Â  Â modifier = Modifier.padding(top = 30.dp, bottom = 5.dp),
 Â  Â onClick = { boxState = BoxState.NormalState }) {
 Â  Â Text(text = "é»˜è®¤çŠ¶æ€")
}
â€‹
Button(
 Â  Â modifier = Modifier.padding(vertical = 5.dp),
 Â  Â onClick = { boxState = BoxState.ChargeState }) {
 Â  Â Text(text = "å……ç”µçŠ¶æ€")
}
å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°ä»£ç è¾ƒä¸Šé¢åŸºæœ¬æ²¡ä»€ä¹ˆæ”¹åŠ¨ï¼Œåªæ˜¯åœ¨ç‚¹å‡»çš„æ—¶å€™åˆ‡æ¢äº†å¯¹åº”çš„ `BoxState` å€¼ã€‚ä¸‹é¢å†æ·»åŠ å‡ ä¸ªæŒ‰é’®æ¥å¯¹åº”ä¸Šé¢ç¼–å†™çš„å‡ ç§çŠ¶æ€ï¼š

```
Button(
 Â  Â modifier = Modifier.padding(vertical = 5.dp),
 Â  Â onClick = { boxState = BoxState.PayState }) {
 Â  Â Text(text = "æ”¯ä»˜çŠ¶æ€")
}
â€‹
Button(
 Â  Â modifier = Modifier.padding(vertical = 5.dp),
 Â  Â onClick = { boxState = BoxState.MusicState }) {
 Â  Â Text(text = "éŸ³ä¹çŠ¶æ€")
}
å¤åˆ¶ä»£ç 
```

å—¯ï¼Œä»£ç å¾ˆç®€å•ï¼Œå°±ä¸è¿‡å¤šæè¿°ï¼Œç›´æ¥è¿è¡Œçœ‹æ•ˆæœå§ï¼

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e251cf2818af4c728957c0e008d894c6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å—¯ï¼Œæ•ˆæœæ˜¯ä¸æ˜¯å·²ç»å‡ºæ¥äº†ï¼Œå“ˆå“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œä»£ç å®ç°ä¸ªç®€å•æ ·å¼å›ºç„¶ä¸éš¾ï¼Œä½†æ˜¯å¦‚æœæƒ³æŠŠç³»ç»Ÿåº”ç”¨ç”šè‡³ä¸‰æ–¹åº”ç”¨éƒ½é€‚é…çµåŠ¨å²›å¯ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº‹ã€‚ä¸è¿‡è¿™é‡Œå’±ä»¬å€¼è€ƒè™‘å¦‚ä½•å®ç°çµåŠ¨å²›çš„åŠ¨ç”»ï¼Œå¹¶ä¸æ·±ç©¶ç³»ç»Ÿå®ç°çš„é—®é¢˜åŠç“¶é¢ˆã€‚

å¤šåº”ç”¨çŠ¶æ€
-----

ä¸Šé¢åŸºæœ¬å·²ç»å®ç°äº†çµåŠ¨å²›çš„å¤§éƒ¨åˆ†åŠ¨ç”»ï¼Œä½†çŠ¶æ€ä¸­è¿˜æœ‰ä¸€ä¸ªå¤šåº”ç”¨ï¼Œå°±æ˜¯å¤šä¸ªåº”ç”¨åœ¨çµåŠ¨å²›ä¸Šçš„æ˜¾ç¤ºæ•ˆæœè¿˜æ²¡å¼„ã€‚å¤šåº”ç”¨çŠ¶æ€å’Œåˆ«çš„ä¸å¤ªä¸€æ ·ï¼Œåˆ«çš„çŠ¶æ€éƒ½æ˜¯çµåŠ¨å²›å®½é«˜çš„å˜åŒ–ï¼Œä½†å¤šåº”ç”¨çŠ¶æ€ä¼šå¤šåˆ†å‡ºä¸€ä¸ªå°é»‘åœ†ç‚¹ï¼Œè¿™ä¸ªéœ€è¦å•ç‹¬å†™ä¸‹ã€‚

```
val animateDpAsState by animateDpAsState(
 Â  Â targetValue = if (boxState is BoxState.MoreState) 105.dp else 70.dp,
 Â  Â animationSpec = spring(
 Â  Â  Â  Â dampingRatio = Spring.DampingRatioLowBouncy,
 Â  Â  Â  Â stiffness = Spring.StiffnessMediumLow
 Â   )
)
â€‹
Box {
 Â  Â Box(
 Â  Â  Â  Â modifier = Modifier
 Â  Â  Â  Â  Â   .width(animateSizeAsState.width.dp)
 Â  Â  Â  Â  Â   .height(animateSizeAsState.height.dp)
 Â  Â  Â  Â  Â   .shadow(elevation = 3.dp, shape = RoundedCornerShape(15.dp))
 Â  Â  Â  Â  Â   .background(color = Color.Black),
 Â   )
 Â  Â Box(
 Â  Â  Â  Â modifier = Modifier
 Â  Â  Â  Â  Â   .padding(start = animateDpAsState)
 Â  Â  Â  Â  Â   .size(30.dp)
 Â  Â  Â  Â  Â   .shadow(elevation = 3.dp, shape = RoundedCornerShape(15.dp))
 Â  Â  Â  Â  Â   .background(color = Color.Black)
 Â   )
}
å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°è¿™å—åˆåŠ äº†ä¸€ä¸ªåŠ¨ç”» `animateDpAsState` æ¥å¤„ç†å¤šåº”ç”¨çŠ¶æ€å°é»‘åœ†ç‚¹çš„å±•ç¤ºï¼Œå¦‚æœå½“å‰çŠ¶æ€ä¸ºå¤šåº”ç”¨çŠ¶æ€çš„è¯å³ `padding` å€¼å¢åŠ ï¼Œè¿™æ ·å°é»‘åœ†ç‚¹å°±ä¼šå•ç‹¬æ˜¾ç¤ºå‡ºæ¥ï¼Œåä¹‹ä¸æ˜¯å¤šåº”ç”¨çŠ¶æ€çš„è¯ï¼Œå°é»‘åœ†ç‚¹å°±ä¼šåœ¨çµåŠ¨å²›ä¸‹é¢è¿›è¡Œéšè—ï¼Œä¸è¿›è¡Œå±•ç¤ºã€‚å®ç°æ•ˆæœå°±æ˜¯å¼€å¤´çš„æ•ˆæœäº†ã€‚æ­¤å¤„ä¹Ÿå°±ä¸å†è¿›è¡Œå±•ç¤ºã€‚

å…¶ä»–æ–¹æ¡ˆå®ç°
------

ä¸Šé¢çš„åŠ¨ç”»å®ç°ä¸»è¦ä½¿ç”¨çš„æ˜¯ `animateSizeAsState` ï¼Œè¿™ä¸ªå®ç°å½“ç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†å¦‚æœä¸æ­¢éœ€è¦ `Size` çš„è¯å°±ä¸å¤ªå¤Ÿç”¨äº†ï¼Œæ¯”å¦‚è¿˜éœ€è¦é€æ˜åº¦çš„å˜åŒ–ï¼Œäº¦æˆ–è€…è¿˜éœ€è¦æ—‹è½¬ç¼©æ”¾ç­‰æ“ä½œçš„æ—¶å€™å°±ä¸å¤Ÿç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåˆ«æ‹…å¿ƒï¼Œå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº† `updateTransition` æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œ`Transition` å¯ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨ç”»ä½œä¸ºå…¶å­é¡¹ï¼Œå¹¶åœ¨å¤šä¸ªçŠ¶æ€ä¹‹é—´åŒæ—¶è¿è¡Œè¿™äº›åŠ¨ç”»ã€‚

å…¶å® `updateTransition` å’±ä»¬å¹¶ä¸é™Œç”Ÿï¼Œåœ¨ [Compose åŠ¨ç”»è‰ºæœ¯æ¢ç´¢ä¹‹å¯è§æ€§åŠ¨ç”»](https://juejin.cn/post/7146034360670486542 "https://juejin.cn/post/7146034360670486542") è¿™ç¯‡æ–‡ç« ä¸­ä¹Ÿæåˆ°è¿‡ï¼Œ`AnimatedVisibility` æºç ä¸­å°±ä½¿ç”¨åˆ°äº†ã€‚

ä¸‹é¢æ¥è¯•ç€å°† `animateSizeAsState` ä¿®æ”¹ä¸º `updateTransition` ã€‚

```
val transition = updateTransition(targetState = boxState, label = "transition")
â€‹
val boxHeight by transition.animateDp(label = "height", transitionSpec = boxSizeSpec()) {
 Â  Â boxState.height
}
val boxWidth by transition.animateDp(label = "width", transitionSpec = boxSizeSpec()) {
 Â  Â boxState.width
}
â€‹
Box(
 Â  Â modifier = Modifier
 Â  Â  Â   .width(boxWidth)
 Â  Â  Â   .height(boxHeight)
 Â  Â  Â   .shadow(elevation = 3.dp, shape = RoundedCornerShape(15.dp))
 Â  Â  Â   .background(color = Color.Black),
)
å¤åˆ¶ä»£ç 
```

ä½¿ç”¨æ–¹æ³•å¹¶ä¸éš¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº† `animateDp` æ–¹æ³•æ¥å¤„ç†çµåŠ¨å²›çš„å®½é«˜åŠ¨ç”»ï¼Œç„¶åè®¾ç½®äº†ä¸‹åŠ¨ç”»è§„æ ¼ï¼Œä¸ºäº†æ–¹ä¾¿è¿™é‡Œå°†åŠ¨ç”»è§„æ ¼æŠ½å–äº†ä¸‹ï¼Œå…¶å®å’Œä¸Šé¢ä½¿ç”¨çš„ä¸€è‡´ï¼Œéƒ½æ˜¯ `spring` ï¼›`transition` è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å¸¸ç”¨çš„åŠ¨ç”»æ–¹æ³•ï¼Œæ¥çœ‹ä¸‹æœ‰å“ªäº›å§ï¼

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31707cda562b4dbf99f7012a79ae9217~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

ä¸Šå›¾ä¸­çš„åŠ¨ç”»æ–¹æ³•éƒ½å¯ä»¥è¿›è¡Œä½¿ç”¨ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨ã€‚

ä¸‹é¢æ¥è¿è¡Œçœ‹ä¸‹ `updateTransition` å®ç°çš„æ•ˆæœå§ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86d5a0aed9f14bf7a3f5710b83013652~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

å¯ä»¥çœ‹åˆ°æ•ˆæœåŸºæœ¬ä¸€è‡´ï¼Œå¦‚æœä¸éœ€è¦åˆ«çš„å‚æ•°ç›´æ¥ä½¿ç”¨ `animateSizeAsState` å°±è¶³å¤Ÿäº†ï¼Œä½†å¦‚æœéœ€è¦åˆ«çš„ä¸€äº›æ“ä½œçš„è¯å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ `updateTransition` æ¥å®ç°äº†ã€‚

å¤šä¸ªåº”ç”¨åˆ‡æ¢ä¼˜åŒ–
--------

å¤šåº”ç”¨çŠ¶æ€è‹¹æœå®ç°çš„æ ·å¼ä¸­æœ‰ç±»ä¼¼æ°´æ»´çš„åŠ¨æ•ˆï¼Œè¿™å—éœ€è¦ä½¿ç”¨äºŒé˜¶è´å¡å°”æ›²çº¿ï¼Œå…¶å®å¹¶ä¸å¤æ‚ï¼Œæ¥çœ‹ä¸‹ä»£ç ï¼š

```
Canvas(modifier = Modifier.padding(start = 70.dp)) {
 Â  Â val path = Path()
 Â  Â val width = (animateFloatAsState + 30) * density
 Â  Â val x = animateFloatAsState * density
 Â  Â val p2x = density * 15f
 Â  Â val p2y = density * 25f
 Â  Â val p1x = density * 15f
 Â  Â val p1y = density * 5f
 Â  Â val p4x = width - 15f * density
 Â  Â val p4y = density * 30f
 Â  Â val p3x = width - 15f * density
 Â  Â val p3y = 0f
 Â  Â val c2x = (abs(p4x - p2x)) / 2
 Â  Â val c2y = density * 20f
 Â  Â val c1x = (abs(p3x - p1x)) / 2
 Â  Â val c1y = density * 10f
 Â  Â path.moveTo(p2x, p2y)
 Â  Â path.lineTo(p1x, p1y)
 Â  Â // ç”¨äºŒé˜¶è´å¡å°”æ›²çº¿ç”»å³è¾¹çš„æ›²çº¿ï¼Œå‚æ•°çš„ç¬¬ä¸€ä¸ªç‚¹æ˜¯ä¸Šé¢çš„ä¸€ä¸ªæ§åˆ¶ç‚¹
 Â  Â path.quadraticBezierTo(c1x, c1y, p3x, p3y)
 Â  Â path.lineTo(p4x, p4y)
 Â  Â // ç”¨äºŒé˜¶è´å¡å°”æ›²çº¿ç”»å·¦è¾¹è¾¹çš„æ›²çº¿ï¼Œå‚æ•°çš„ç¬¬ä¸€ä¸ªç‚¹æ˜¯ä¸‹é¢çš„ä¸€ä¸ªæ§åˆ¶ç‚¹
 Â  Â path.quadraticBezierTo(c2x, c2y, p2x, p2y)
â€‹
 Â  Â if (animateFloatAsState == 35f) {
 Â  Â  Â  Â path.reset()
 Â   } else {
 Â  Â  Â  Â drawPath(
 Â  Â  Â  Â  Â  Â path = path, color = Color.Black,
 Â  Â  Â  Â  Â  Â style = Fill
 Â  Â  Â   )
 Â   }
â€‹
 Â  Â path.addOval(Rect(x + 0f, 0f, x + density * 30f, density * 30f))
 Â  Â path.close()
 Â  Â drawPath(
 Â  Â  Â  Â path = path, color = Color.Black,
 Â  Â  Â  Â style = Fill
 Â   )
}
å¤åˆ¶ä»£ç 
```

å—¯ï¼Œçœ‹ç€å…¶å®è¿˜æŒºå¤šï¼Œå…¶å®å¹¶ä¸éš¾ï¼Œç¡®å®šå¥½å››ä¸ªä¸ªç‚¹ï¼Œç„¶åè¿æ¥ä¸Šè‰²å°±è¡Œï¼Œç„¶åæ ¹æ®å°é»‘åœ†ç‚¹çš„ä½ç½®åŠ¨æ€ç»˜åˆ¶è¿æ¥éƒ¨åˆ†å³å¯ï¼Œå…³äºè´å¡å°”æ›²çº¿åœ¨è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œå¤§ä¼™åº”è¯¥æ¯”æˆ‘æ‡‚ã€‚æœ€åæ¥çœ‹ä¸‹æ•ˆæœå§ï¼

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4ef03c773bd4547bf2a24ef8613cd35~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

è¿™å›æ˜¯ä¸æ˜¯å°±æœ‰ç‚¹åƒäº†ï¼Œå“ˆå“ˆå“ˆï¼

æ‰“å®Œæ”¶å·¥
----

æœ¬æ–‡å¸¦å¤§å®¶ä¸€èµ·å†™äº†ä¸‹å½“ä¸‹å¾ˆç«çš„è‹¹æœçµåŠ¨å²›ï¼Œåªæ˜¯æœ€ç®€å•çš„æ¨¡ä»¿å®ç°ï¼Œæ•ˆæœè‚¯å®šä¸å¦‚è‹¹æœè°ƒæ•™ä¸€å¹´çš„æ•ˆæœï¼Œä»…ä¾›å¤§å®¶å‚è€ƒã€‚

æœ¬æ–‡æ‰€æœ‰ä»£ç éƒ½åœ¨ Github ä¸­ï¼š[github.com/zhujiang521â€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhujiang521%2F "https://github.com/zhujiang521/")

æœ¬æ–‡è‡³æ­¤ç»“æŸï¼Œæœ‰ç”¨çš„åœ°æ–¹å¤§å®¶å¯ä»¥å‚è€ƒï¼Œå½“ç„¶å¦‚æœèƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼Œå“ªæ€•æ˜¯ä¸€ç‚¹ä¹Ÿè¶³å¤Ÿäº†ã€‚å°±è¿™æ ·ã€‚